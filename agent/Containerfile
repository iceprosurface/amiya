# syntax=docker/dockerfile:1.6
FROM node:24

RUN --mount=type=cache,target=/var/lib/apt/lists,sharing=locked \
  --mount=type=cache,target=/var/cache/apt,sharing=locked \
  apt-get update \
  && apt-get install -y --no-install-recommends bash ca-certificates unzip tar git openssh-client

ENV HOME="/root"
RUN --mount=type=cache,target=/root/.npm npm install -g opencode-ai

WORKDIR /app
COPY agent/package.json ./
RUN npm install --omit=dev

COPY agent/index.js ./index.js
COPY agent/plugins/ ./plugins/

WORKDIR /workspace
CMD ["node", "/app/index.js"]
